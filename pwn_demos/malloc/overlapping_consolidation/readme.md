# Overlapping Consolidation

So in this instance, we will again be using backwards consolidation to allocate overlapping chunks (multiple ptrs to the same spot without freeing the chunk). However, this differs from the previous example. We will be leveraging existing chunks, and editing their chunk headers to accomplish this. This may be more useful in certain CTF challs.

Here is the code:

```
#include <stdio.h>
#include <stdlib.h>

#define CHUNK_SIZE 0x420
#define CHUNK_SIZE_HEADER_VALUE 0x431
#define CONSOLIDATED_SIZE 0x471

#define FAKE_CHUNK_PREV_SIZE 0x470
#define FAKE_CHUNK_SIZE 0x21

#define CHECK_CHUNK_PREV_SIZE 0x20
#define CHECK_CHUNK_SIZE 0x30

#define CONSOLIDATED_CHUNK_ALLOCATION_SIZE 0x480

void main() {
	long *chunk0,
        	*chunk1,
        	*chunk2,
        	*chunk3,
        	*first_consolidated_chunk,
        	*overlapping_chunk;

	printf("So for this time, we will try to allocate overlapping chunks.\n");
	printf("We will use backwards chunk consolidation to do this.\n");
	printf("We will not make a fake heap chunk for this consolidation method.\n");
	printf("Instead we will be leveraging existing chunks.\n\n");

	printf("We will go ahead, and allocate four separate chunks.\n");
	printf("The last chunk will be used to prevent consolidation into the top chunk.\n");
	printf("We will go ahead, and free the first chunk.\n");
	printf("Proceeding that, we will go ahead and expand its size, to encompass the first two chunks.\n");
	printf("Then for the third chunk we will make the PREV_INUSE bit as 0.\n");
	printf("In addition for the third chunk, we will set the prev_size to the expanded size of the first chunk.\n\n");

	printf("At this point, from the perspective of the heap chunk headers, the third chunk directly follows the first chunk.\n\n");
	printf("On top of that, the first chunk has been freed.\n");
	printf("We will go ahead and free the third chunk, which will be consolidated into the first.\n");
	printf("Of course this consolidated chunk will also include our second heap chunk, even though it hasn't been freed.\n\n");

	printf("Once we get the large consolidated chunk, we will allocate a smaller chunk from it.\n");
	printf("This smaller chunk will be the original size of the first chunk.\n");
	printf("This way, the next allocation from the consolidated chunk, will begin where the second chunk starts.\n");
	printf("That will allow us to allocate the same chunk multiple times without freeing it.\n\n");


	chunk0 = malloc(CHUNK_SIZE);
	chunk1 = malloc(CHUNK_SIZE);
	chunk2 = malloc(CHUNK_SIZE);
	chunk3 = malloc(CHUNK_SIZE);


	printf("Here are our chunks:\n\n");

	printf("Chunk0:\t%p\n", chunk0);
	printf("Chunk1:\t%p\n", chunk1);
	printf("Chunk2:\t%p\n", chunk2);
	printf("Chunk3:\t%p\n\n", chunk3);

	printf("Now to free chunk0!\n\n");

	free(chunk0);

	printf("Now to expand the size of chunk0, and set heap chunk data for chunk2.\n\n");

	chunk2[-1] = 0x430;
	chunk2[-2] = 0x860;

	chunk0[-1] = 0x860;

	printf("Now to free chunk2, and cause chunk consolidation to swallow chunk1.\n\n");

	free(chunk2);

	first_consolidated_chunk = malloc(CHUNK_SIZE);
	overlapping_chunk = malloc(CHUNK_SIZE);

	printf("First chunk allocated from consolidated chunk: %p\n", first_consolidated_chunk);
	printf("Overlapping Chunk: %p\n", overlapping_chunk);
	printf("Is the chunk overlapping:\t%s\n", overlapping_chunk==chunk1?"True":"False");
}
```

## Explanation

So, for how this is going to work. It will take three chunks (I allocate a fourth chunk after this, to prevent consolidation into the top chunk). The goal will be to reallocate the middle (second) chunk. We will at first free the first chunk. Then, we will edit the chunk header size value of the first chunk, to expand it to encompass the entirety of the second chunk. Then, we will edit the chunk header of the third chunk, to make it seem like the previous chunk was the expanded first chunk. This will include setting the `prev_size` to be that of the expanded first chunk size, and setting the `prev_inuse` bit to be 0.

After that, we will free the third chunk, to cause it to consolidate into the first chunk. This consolidated chunk will of course contain the second chunk, which we haven't freed yet. We will allocate a chunk from the consolidated chunk, equal to the size of the first chunk. This will put the start of the consolidated chunk, to directly overlap with the second chunk. Then, with another allocation from the consolidated chunk, we will have allocated overlapping chunks.

Let's see this in action:

```
$    gdb ./overlapping_consolidation
GNU gdb (Ubuntu 12.0.90-0ubuntu1) 12.0.90
Copyright (C) 2022 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type "show copying" and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<https://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
	<http://www.gnu.org/software/gdb/documentation/>.

For help, type "help".
Type "apropos word" to search for commands related to "word"...
GEF for linux ready, type `gef' to start, `gef config' to configure
88 commands loaded and 5 functions added for GDB 12.0.90 in 0.00ms using Python engine 3.10
Reading symbols from ./overlapping_consolidation...
(No debugging symbols found in ./overlapping_consolidation)
gef➤  disas main
Dump of assembler code for function main:
   0x00000000000011a9 <+0>:    endbr64
   0x00000000000011ad <+4>:    push   rbp
   0x00000000000011ae <+5>:    mov	rbp,rsp
   0x00000000000011b1 <+8>:    sub	rsp,0x30
   0x00000000000011b5 <+12>:    lea	rax,[rip+0xe4c]    	# 0x2008
   0x00000000000011bc <+19>:    mov	rdi,rax
   0x00000000000011bf <+22>:    call   0x1090 <puts@plt>
   0x00000000000011c4 <+27>:    lea	rax,[rip+0xe7d]    	# 0x2048
   0x00000000000011cb <+34>:    mov	rdi,rax
   0x00000000000011ce <+37>:    call   0x1090 <puts@plt>
   0x00000000000011d3 <+42>:    lea	rax,[rip+0xea6]    	# 0x2080
   0x00000000000011da <+49>:    mov	rdi,rax
   0x00000000000011dd <+52>:    call   0x1090 <puts@plt>
   0x00000000000011e2 <+57>:    lea	rax,[rip+0xedf]    	# 0x20c8
   0x00000000000011e9 <+64>:    mov	rdi,rax
   0x00000000000011ec <+67>:    call   0x1090 <puts@plt>
   0x00000000000011f1 <+72>:    lea	rax,[rip+0xf00]    	# 0x20f8
   0x00000000000011f8 <+79>:    mov	rdi,rax
   0x00000000000011fb <+82>:    call   0x1090 <puts@plt>
   0x0000000000001200 <+87>:    lea	rax,[rip+0xf29]    	# 0x2130
   0x0000000000001207 <+94>:    mov	rdi,rax
   0x000000000000120a <+97>:    call   0x1090 <puts@plt>
   0x000000000000120f <+102>:    lea	rax,[rip+0xf6a]    	# 0x2180
   0x0000000000001216 <+109>:    mov	rdi,rax
   0x0000000000001219 <+112>:    call   0x1090 <puts@plt>
   0x000000000000121e <+117>:    lea	rax,[rip+0xf8b]    	# 0x21b0
   0x0000000000001225 <+124>:    mov	rdi,rax
   0x0000000000001228 <+127>:    call   0x1090 <puts@plt>
   0x000000000000122d <+132>:    lea	rax,[rip+0xfdc]    	# 0x2210
   0x0000000000001234 <+139>:    mov	rdi,rax
   0x0000000000001237 <+142>:    call   0x1090 <puts@plt>
   0x000000000000123c <+147>:    lea	rax,[rip+0x100d]    	# 0x2250
   0x0000000000001243 <+154>:    mov	rdi,rax
   0x0000000000001246 <+157>:    call   0x1090 <puts@plt>
   0x000000000000124b <+162>:    lea	rax,[rip+0x1066]    	# 0x22b8
   0x0000000000001252 <+169>:    mov	rdi,rax
   0x0000000000001255 <+172>:    call   0x1090 <puts@plt>
   0x000000000000125a <+177>:    lea	rax,[rip+0x10cf]    	# 0x2330
   0x0000000000001261 <+184>:    mov	rdi,rax
   0x0000000000001264 <+187>:    call   0x1090 <puts@plt>
   0x0000000000001269 <+192>:    lea	rax,[rip+0x10f0]    	# 0x2360
   0x0000000000001270 <+199>:    mov	rdi,rax
   0x0000000000001273 <+202>:    call   0x1090 <puts@plt>
   0x0000000000001278 <+207>:    lea	rax,[rip+0x1139]    	# 0x23b8
   0x000000000000127f <+214>:    mov	rdi,rax
   0x0000000000001282 <+217>:    call   0x1090 <puts@plt>
   0x0000000000001287 <+222>:    lea	rax,[rip+0x119a]    	# 0x2428
   0x000000000000128e <+229>:    mov	rdi,rax
   0x0000000000001291 <+232>:    call   0x1090 <puts@plt>
   0x0000000000001296 <+237>:    lea	rax,[rip+0x11e3]    	# 0x2480
   0x000000000000129d <+244>:    mov	rdi,rax
   0x00000000000012a0 <+247>:    call   0x1090 <puts@plt>
   0x00000000000012a5 <+252>:    lea	rax,[rip+0x121c]    	# 0x24c8
   0x00000000000012ac <+259>:    mov	rdi,rax
   0x00000000000012af <+262>:    call   0x1090 <puts@plt>
   0x00000000000012b4 <+267>:    lea	rax,[rip+0x1275]    	# 0x2530
   0x00000000000012bb <+274>:    mov	rdi,rax
   0x00000000000012be <+277>:    call   0x1090 <puts@plt>
   0x00000000000012c3 <+282>:    mov	edi,0x420
   0x00000000000012c8 <+287>:    call   0x10b0 <malloc@plt>
   0x00000000000012cd <+292>:    mov	QWORD PTR [rbp-0x30],rax
   0x00000000000012d1 <+296>:    mov	edi,0x420
   0x00000000000012d6 <+301>:    call   0x10b0 <malloc@plt>
   0x00000000000012db <+306>:    mov	QWORD PTR [rbp-0x28],rax
   0x00000000000012df <+310>:    mov	edi,0x420
   0x00000000000012e4 <+315>:    call   0x10b0 <malloc@plt>
   0x00000000000012e9 <+320>:    mov	QWORD PTR [rbp-0x20],rax
   0x00000000000012ed <+324>:    mov	edi,0x420
   0x00000000000012f2 <+329>:    call   0x10b0 <malloc@plt>
   0x00000000000012f7 <+334>:    mov	QWORD PTR [rbp-0x18],rax
   0x00000000000012fb <+338>:    lea	rax,[rip+0x1280]    	# 0x2582
   0x0000000000001302 <+345>:    mov	rdi,rax
   0x0000000000001305 <+348>:    call   0x1090 <puts@plt>
   0x000000000000130a <+353>:    mov	rax,QWORD PTR [rbp-0x30]
   0x000000000000130e <+357>:    mov	rsi,rax
   0x0000000000001311 <+360>:    lea	rax,[rip+0x1280]    	# 0x2598
   0x0000000000001318 <+367>:    mov	rdi,rax
   0x000000000000131b <+370>:    mov	eax,0x0
   0x0000000000001320 <+375>:    call   0x10a0 <printf@plt>
   0x0000000000001325 <+380>:    mov	rax,QWORD PTR [rbp-0x28]
   0x0000000000001329 <+384>:    mov	rsi,rax
   0x000000000000132c <+387>:    lea	rax,[rip+0x1271]    	# 0x25a4
   0x0000000000001333 <+394>:    mov	rdi,rax
   0x0000000000001336 <+397>:    mov	eax,0x0
   0x000000000000133b <+402>:    call   0x10a0 <printf@plt>
   0x0000000000001340 <+407>:    mov	rax,QWORD PTR [rbp-0x20]
   0x0000000000001344 <+411>:    mov	rsi,rax
   0x0000000000001347 <+414>:    lea	rax,[rip+0x1262]    	# 0x25b0
   0x000000000000134e <+421>:    mov	rdi,rax
   0x0000000000001351 <+424>:    mov	eax,0x0
   0x0000000000001356 <+429>:    call   0x10a0 <printf@plt>
   0x000000000000135b <+434>:    mov	rax,QWORD PTR [rbp-0x18]
   0x000000000000135f <+438>:    mov	rsi,rax
   0x0000000000001362 <+441>:    lea	rax,[rip+0x1253]    	# 0x25bc
   0x0000000000001369 <+448>:    mov	rdi,rax
   0x000000000000136c <+451>:    mov	eax,0x0
   0x0000000000001371 <+456>:    call   0x10a0 <printf@plt>
   0x0000000000001376 <+461>:    lea	rax,[rip+0x124c]    	# 0x25c9
   0x000000000000137d <+468>:    mov	rdi,rax
   0x0000000000001380 <+471>:    call   0x1090 <puts@plt>
   0x0000000000001385 <+476>:    mov	rax,QWORD PTR [rbp-0x30]
   0x0000000000001389 <+480>:    mov	rdi,rax
   0x000000000000138c <+483>:    call   0x1080 <free@plt>
   0x0000000000001391 <+488>:    lea	rax,[rip+0x1248]    	# 0x25e0
   0x0000000000001398 <+495>:    mov	rdi,rax
   0x000000000000139b <+498>:    call   0x1090 <puts@plt>
   0x00000000000013a0 <+503>:    mov	rax,QWORD PTR [rbp-0x20]
   0x00000000000013a4 <+507>:    sub	rax,0x8
   0x00000000000013a8 <+511>:    mov	QWORD PTR [rax],0x430
   0x00000000000013af <+518>:    mov	rax,QWORD PTR [rbp-0x20]
   0x00000000000013b3 <+522>:    sub	rax,0x10
   0x00000000000013b7 <+526>:    mov	QWORD PTR [rax],0x860
   0x00000000000013be <+533>:    mov	rax,QWORD PTR [rbp-0x30]
   0x00000000000013c2 <+537>:    sub	rax,0x8
   0x00000000000013c6 <+541>:    mov	QWORD PTR [rax],0x860
   0x00000000000013cd <+548>:    lea	rax,[rip+0x1254]    	# 0x2628
   0x00000000000013d4 <+555>:    mov	rdi,rax
   0x00000000000013d7 <+558>:    call   0x1090 <puts@plt>
   0x00000000000013dc <+563>:    mov	rax,QWORD PTR [rbp-0x20]
   0x00000000000013e0 <+567>:    mov	rdi,rax
   0x00000000000013e3 <+570>:    call   0x1080 <free@plt>
   0x00000000000013e8 <+575>:    mov	edi,0x420
   0x00000000000013ed <+580>:    call   0x10b0 <malloc@plt>
   0x00000000000013f2 <+585>:    mov	QWORD PTR [rbp-0x10],rax
   0x00000000000013f6 <+589>:    mov	edi,0x420
   0x00000000000013fb <+594>:    call   0x10b0 <malloc@plt>
   0x0000000000001400 <+599>:    mov	QWORD PTR [rbp-0x8],rax
   0x0000000000001404 <+603>:    mov	rax,QWORD PTR [rbp-0x10]
   0x0000000000001408 <+607>:    mov	rsi,rax
   0x000000000000140b <+610>:    lea	rax,[rip+0x125e]    	# 0x2670
   0x0000000000001412 <+617>:    mov	rdi,rax
   0x0000000000001415 <+620>:    mov	eax,0x0
   0x000000000000141a <+625>:    call   0x10a0 <printf@plt>
   0x000000000000141f <+630>:    mov	rax,QWORD PTR [rbp-0x8]
   0x0000000000001423 <+634>:    mov	rsi,rax
   0x0000000000001426 <+637>:    lea	rax,[rip+0x1276]    	# 0x26a3
   0x000000000000142d <+644>:    mov	rdi,rax
   0x0000000000001430 <+647>:    mov	eax,0x0
   0x0000000000001435 <+652>:    call   0x10a0 <printf@plt>
   0x000000000000143a <+657>:    mov	rax,QWORD PTR [rbp-0x8]
   0x000000000000143e <+661>:    cmp	rax,QWORD PTR [rbp-0x28]
   0x0000000000001442 <+665>:    jne	0x144d <main+676>
   0x0000000000001444 <+667>:    lea	rax,[rip+0x126f]    	# 0x26ba
   0x000000000000144b <+674>:    jmp	0x1454 <main+683>
   0x000000000000144d <+676>:    lea	rax,[rip+0x126b]    	# 0x26bf
   0x0000000000001454 <+683>:    mov	rsi,rax
   0x0000000000001457 <+686>:    lea	rax,[rip+0x1267]    	# 0x26c5
   0x000000000000145e <+693>:    mov	rdi,rax
   0x0000000000001461 <+696>:    mov	eax,0x0
   0x0000000000001466 <+701>:    call   0x10a0 <printf@plt>
   0x000000000000146b <+706>:    nop
   0x000000000000146c <+707>:    leave  
   0x000000000000146d <+708>:    ret    
End of assembler dump.
gef➤  b *main+292
Breakpoint 1 at 0x12cd
gef➤  b *main+488
Breakpoint 2 at 0x1391
gef➤  b *main+570
Breakpoint 3 at 0x13e3
gef➤  b *main+575
Breakpoint 4 at 0x13e8
gef➤  b *main+585
Breakpoint 5 at 0x13f2
gef➤  b *main+599
Breakpoint 6 at 0x1400
gef➤  r
Starting program: /Hackery/shogun/pwn_demos/malloc/overlapping_consolidation/overlapping_consolidation
warning: File "/home/guy/glibc-2.38/compiled-2.38/lib/libthread_db.so.1" auto-loading has been declined by your `auto-load safe-path' set to "$debugdir:$datadir/auto-load".
To enable execution of this file add
    add-auto-load-safe-path /home/guy/glibc-2.38/compiled-2.38/lib/libthread_db.so.1
line to your configuration file "/home/guy/.gdbinit".
To completely disable this security protection add
    set auto-load safe-path /
line to your configuration file "/home/guy/.gdbinit".
For more information about this security protection see the
"Auto-loading safe path" section in the GDB manual.  E.g., run from the shell:
    info "(gdb)Auto-loading safe path"
warning: Unable to find libthread_db matching inferior's thread library, thread debugging will not be available.
So for this time, we will try to allocate overlapping chunks.
We will use backwards chunk consolidation to do this.
We will not make a fake heap chunk for this consolidation method.
Instead we will be leveraging existing chunks.

We will go ahead, and allocate four separate chunks.
The last chunk will be used to prevent consolidation into the top chunk.
We will go ahead, and free the first chunk.
Proceeding that, we will go ahead and expand it's size, to encompass the first two chunks.
Then for the third chunk we will make the PREV_INUSE bit as 0.
In addition for the third chunk, we will set the prev_size to the expanded size of the first chunk.

At this point, from the perspective of the heap chunk headers, the third chunk directly follows the first chunk.

On top of that, the first chunk has been freed.
We will go ahead and free the third chunk, which will be consolidated into the first.
Of course this consolidated chunk will also include our second heap chunk, even though it hasn't been freed.

Once we get the large consolidated chunk, we will allocate a smaller chunk from it.
This smaller chunk will be the original size of the first chunk.
This way, the next allocation from the consolidated chunk, will begin where the second chunk starts.
That will allow us to allocate the same chunk multiple times without freeing it.


Breakpoint 1, 0x00005555555552cd in main ()

[ Legend: Modified register | Code | Heap | Stack | String ]
────────────────────────────────────────────────────────────────────────────────────── registers ────
$rax   : 0x00005555555596b0  →  0x0000000000000000
$rbx   : 0x0          	 
$rcx   : 0x431        	 
$rdx   : 0x0          	 
$rsp   : 0x00007fffffffdf60  →  0x0000000000000000
$rbp   : 0x00007fffffffdf90  →  0x0000000000000001
$rsi   : 0x420        	 
$rdi   : 0x00005555555596b0  →  0x0000000000000000
$rip   : 0x00005555555552cd  →  <main+292> mov QWORD PTR [rbp-0x30], rax
$r8	: 0x3          	 
$r9	: 0x77         	 
$r10   : 0x5d         	 
$r11   : 0x00007ffff7e2cca0  →  0x0000000000000000
$r12   : 0x00007fffffffe0a8  →  0x00007fffffffe3ab  →  "/Hackery/shogun/pwn_demos/malloc/overlapp[...]"
$r13   : 0x00005555555551a9  →  <main+0> endbr64
$r14   : 0x0000555555557d98  →  0x0000555555555160  →  <__do_global_dtors_aux+0> endbr64
$r15   : 0x00007ffff7ffd020  →  0x00007ffff7ffe2e0  →  0x0000555555554000  →   jg 0x555555554047
$eflags: [zero carry parity adjust sign trap INTERRUPT direction overflow resume virtualx86 identification]
$cs: 0x33 $ss: 0x2b $ds: 0x00 $es: 0x00 $fs: 0x00 $gs: 0x00
────────────────────────────────────────────────────────────────────────────────────────── stack ────
0x00007fffffffdf60│+0x0000: 0x0000000000000000     ← $rsp
0x00007fffffffdf68│+0x0008: 0x0000000000000000
0x00007fffffffdf70│+0x0010: 0x0000000000000000
0x00007fffffffdf78│+0x0018: 0x0000000000000000
0x00007fffffffdf80│+0x0020: 0x0000000000000000
0x00007fffffffdf88│+0x0028: 0x00007ffff7fe5080  →  <dl_main+0> endbr64
0x00007fffffffdf90│+0x0030: 0x0000000000000001     ← $rbp
0x00007fffffffdf98│+0x0038: 0x00007ffff7c23fbd  →  <__libc_start_call_main+109> mov edi, eax
──────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────
   0x5555555552be <main+277>   	call   0x555555555090 <puts@plt>
   0x5555555552c3 <main+282>   	mov	edi, 0x420
   0x5555555552c8 <main+287>   	call   0x5555555550b0 <malloc@plt>
 → 0x5555555552cd <main+292>   	mov	QWORD PTR [rbp-0x30], rax
   0x5555555552d1 <main+296>   	mov	edi, 0x420
   0x5555555552d6 <main+301>   	call   0x5555555550b0 <malloc@plt>
   0x5555555552db <main+306>   	mov	QWORD PTR [rbp-0x28], rax
   0x5555555552df <main+310>   	mov	edi, 0x420
   0x5555555552e4 <main+315>   	call   0x5555555550b0 <malloc@plt>
──────────────────────────────────────────────────────────────────────────────────────── threads ────
[#0] Id 1, Name: "overlapping_con", stopped 0x5555555552cd in main (), reason: BREAKPOINT
────────────────────────────────────────────────────────────────────────────────────────── trace ────
[#0] 0x5555555552cd → main()
─────────────────────────────────────────────────────────────────────────────────────────────────────
gef➤  p $rax
$1 = 0x5555555596b0
gef➤  c
Continuing.
Here are our chunks:

Chunk0:    0x5555555596b0
Chunk1:    0x555555559ae0
Chunk2:    0x555555559f10
Chunk3:    0x55555555a340

Now to free chunk0!


Breakpoint 2, 0x0000555555555391 in main ()

[ Legend: Modified register | Code | Heap | Stack | String ]
────────────────────────────────────────────────────────────────────────────────────── registers ────
$rax   : 0x1          	 
$rbx   : 0x0          	 
$rcx   : 0x41         	 
$rdx   : 0x00007ffff7e2cd00  →  0x000055555555a760  →  0x0000000000000000
$rsp   : 0x00007fffffffdf60  →  0x00005555555596b0  →  0x00007ffff7e2cd00  →  0x000055555555a760  →  0x0000000000000000
$rbp   : 0x00007fffffffdf90  →  0x0000000000000001
$rsi   : 0x0          	 
$rdi   : 0x00007ffff7e2cca0  →  0x0000000000000000
$rip   : 0x0000555555555391  →  <main+488> lea rax, [rip+0x1248]    	# 0x5555555565e0
$r8	: 0x0          	 
$r9	: 0x0          	 
$r10   : 0x00007fffffffdd0c  →  0x0000000000007fff
$r11   : 0x202        	 
$r12   : 0x00007fffffffe0a8  →  0x00007fffffffe3ab  →  "/Hackery/shogun/pwn_demos/malloc/overlapp[...]"
$r13   : 0x00005555555551a9  →  <main+0> endbr64
$r14   : 0x0000555555557d98  →  0x0000555555555160  →  <__do_global_dtors_aux+0> endbr64
$r15   : 0x00007ffff7ffd020  →  0x00007ffff7ffe2e0  →  0x0000555555554000  →   jg 0x555555554047
$eflags: [zero carry PARITY adjust sign trap INTERRUPT direction overflow resume virtualx86 identification]
$cs: 0x33 $ss: 0x2b $ds: 0x00 $es: 0x00 $fs: 0x00 $gs: 0x00
────────────────────────────────────────────────────────────────────────────────────────── stack ────
0x00007fffffffdf60│+0x0000: 0x00005555555596b0  →  0x00007ffff7e2cd00  →  0x000055555555a760  →  0x0000000000000000     ← $rsp
0x00007fffffffdf68│+0x0008: 0x0000555555559ae0  →  0x0000000000000000
0x00007fffffffdf70│+0x0010: 0x0000555555559f10  →  0x0000000000000000
0x00007fffffffdf78│+0x0018: 0x000055555555a340  →  0x0000000000000000
0x00007fffffffdf80│+0x0020: 0x0000000000000000
0x00007fffffffdf88│+0x0028: 0x00007ffff7fe5080  →  <dl_main+0> endbr64
0x00007fffffffdf90│+0x0030: 0x0000000000000001     ← $rbp
0x00007fffffffdf98│+0x0038: 0x00007ffff7c23fbd  →  <__libc_start_call_main+109> mov edi, eax
──────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────
   0x555555555385 <main+476>   	mov	rax, QWORD PTR [rbp-0x30]
   0x555555555389 <main+480>   	mov	rdi, rax
   0x55555555538c <main+483>   	call   0x555555555080 <free@plt>
 → 0x555555555391 <main+488>   	lea	rax, [rip+0x1248]    	# 0x5555555565e0
   0x555555555398 <main+495>   	mov	rdi, rax
   0x55555555539b <main+498>   	call   0x555555555090 <puts@plt>
   0x5555555553a0 <main+503>   	mov	rax, QWORD PTR [rbp-0x20]
   0x5555555553a4 <main+507>   	sub	rax, 0x8
   0x5555555553a8 <main+511>   	mov	QWORD PTR [rax], 0x430
──────────────────────────────────────────────────────────────────────────────────────── threads ────
[#0] Id 1, Name: "overlapping_con", stopped 0x555555555391 in main (), reason: BREAKPOINT
────────────────────────────────────────────────────────────────────────────────────────── trace ────
[#0] 0x555555555391 → main()
─────────────────────────────────────────────────────────────────────────────────────────────────────
gef➤  x/400g 0x5555555596a0
0x5555555596a0:    0x0    0x431
0x5555555596b0:    0x7ffff7e2cd00    0x7ffff7e2cd00
0x5555555596c0:    0x0    0x0
0x5555555596d0:    0x0    0x0
0x5555555596e0:    0x0    0x0
0x5555555596f0:    0x0    0x0
0x555555559700:    0x0    0x0
0x555555559710:    0x0    0x0
0x555555559720:    0x0    0x0
0x555555559730:    0x0    0x0
0x555555559740:    0x0    0x0
0x555555559750:    0x0    0x0
0x555555559760:    0x0    0x0
0x555555559770:    0x0    0x0
0x555555559780:    0x0    0x0
0x555555559790:    0x0    0x0
0x5555555597a0:    0x0    0x0
0x5555555597b0:    0x0    0x0
0x5555555597c0:    0x0    0x0
0x5555555597d0:    0x0    0x0
0x5555555597e0:    0x0    0x0
0x5555555597f0:    0x0    0x0
0x555555559800:    0x0    0x0
0x555555559810:    0x0    0x0
0x555555559820:    0x0    0x0
0x555555559830:    0x0    0x0
0x555555559840:    0x0    0x0
0x555555559850:    0x0    0x0
0x555555559860:    0x0    0x0
0x555555559870:    0x0    0x0
0x555555559880:    0x0    0x0
0x555555559890:    0x0    0x0
0x5555555598a0:    0x0    0x0
0x5555555598b0:    0x0    0x0
0x5555555598c0:    0x0    0x0
0x5555555598d0:    0x0    0x0
0x5555555598e0:    0x0    0x0
0x5555555598f0:    0x0    0x0
0x555555559900:    0x0    0x0
0x555555559910:    0x0    0x0
0x555555559920:    0x0    0x0
0x555555559930:    0x0    0x0
0x555555559940:    0x0    0x0
0x555555559950:    0x0    0x0
0x555555559960:    0x0    0x0
0x555555559970:    0x0    0x0
0x555555559980:    0x0    0x0
0x555555559990:    0x0    0x0
0x5555555599a0:    0x0    0x0
0x5555555599b0:    0x0    0x0
0x5555555599c0:    0x0    0x0
0x5555555599d0:    0x0    0x0
0x5555555599e0:    0x0    0x0
0x5555555599f0:    0x0    0x0
0x555555559a00:    0x0    0x0
0x555555559a10:    0x0    0x0
0x555555559a20:    0x0    0x0
0x555555559a30:    0x0    0x0
0x555555559a40:    0x0    0x0
0x555555559a50:    0x0    0x0
0x555555559a60:    0x0    0x0
0x555555559a70:    0x0    0x0
0x555555559a80:    0x0    0x0
0x555555559a90:    0x0    0x0
0x555555559aa0:    0x0    0x0
0x555555559ab0:    0x0    0x0
0x555555559ac0:    0x0    0x0
0x555555559ad0:    0x430    0x430
0x555555559ae0:    0x0    0x0
0x555555559af0:    0x0    0x0
0x555555559b00:    0x0    0x0
0x555555559b10:    0x0    0x0
0x555555559b20:    0x0    0x0
0x555555559b30:    0x0    0x0
0x555555559b40:    0x0    0x0
0x555555559b50:    0x0    0x0
0x555555559b60:    0x0    0x0
0x555555559b70:    0x0    0x0
0x555555559b80:    0x0    0x0
0x555555559b90:    0x0    0x0
0x555555559ba0:    0x0    0x0
0x555555559bb0:    0x0    0x0
0x555555559bc0:    0x0    0x0
0x555555559bd0:    0x0    0x0
0x555555559be0:    0x0    0x0
0x555555559bf0:    0x0    0x0
0x555555559c00:    0x0    0x0
0x555555559c10:    0x0    0x0
0x555555559c20:    0x0    0x0
0x555555559c30:    0x0    0x0
0x555555559c40:    0x0    0x0
0x555555559c50:    0x0    0x0
0x555555559c60:    0x0    0x0
0x555555559c70:    0x0    0x0
0x555555559c80:    0x0    0x0
0x555555559c90:    0x0    0x0
0x555555559ca0:    0x0    0x0
0x555555559cb0:    0x0    0x0
0x555555559cc0:    0x0    0x0
0x555555559cd0:    0x0    0x0
0x555555559ce0:    0x0    0x0
0x555555559cf0:    0x0    0x0
0x555555559d00:    0x0    0x0
0x555555559d10:    0x0    0x0
0x555555559d20:    0x0    0x0
0x555555559d30:    0x0    0x0
0x555555559d40:    0x0    0x0
0x555555559d50:    0x0    0x0
0x555555559d60:    0x0    0x0
0x555555559d70:    0x0    0x0
0x555555559d80:    0x0    0x0
0x555555559d90:    0x0    0x0
0x555555559da0:    0x0    0x0
0x555555559db0:    0x0    0x0
0x555555559dc0:    0x0    0x0
0x555555559dd0:    0x0    0x0
0x555555559de0:    0x0    0x0
0x555555559df0:    0x0    0x0
0x555555559e00:    0x0    0x0
0x555555559e10:    0x0    0x0
0x555555559e20:    0x0    0x0
0x555555559e30:    0x0    0x0
0x555555559e40:    0x0    0x0
0x555555559e50:    0x0    0x0
0x555555559e60:    0x0    0x0
0x555555559e70:    0x0    0x0
0x555555559e80:    0x0    0x0
0x555555559e90:    0x0    0x0
0x555555559ea0:    0x0    0x0
0x555555559eb0:    0x0    0x0
0x555555559ec0:    0x0    0x0
0x555555559ed0:    0x0    0x0
0x555555559ee0:    0x0    0x0
0x555555559ef0:    0x0    0x0
0x555555559f00:    0x0    0x431
0x555555559f10:    0x0    0x0
0x555555559f20:    0x0    0x0
0x555555559f30:    0x0    0x0
0x555555559f40:    0x0    0x0
0x555555559f50:    0x0    0x0
0x555555559f60:    0x0    0x0
0x555555559f70:    0x0    0x0
0x555555559f80:    0x0    0x0
0x555555559f90:    0x0    0x0
0x555555559fa0:    0x0    0x0
0x555555559fb0:    0x0    0x0
0x555555559fc0:    0x0    0x0
0x555555559fd0:    0x0    0x0
0x555555559fe0:    0x0    0x0
0x555555559ff0:    0x0    0x0
0x55555555a000:    0x0    0x0
0x55555555a010:    0x0    0x0
0x55555555a020:    0x0    0x0
0x55555555a030:    0x0    0x0
0x55555555a040:    0x0    0x0
0x55555555a050:    0x0    0x0
0x55555555a060:    0x0    0x0
0x55555555a070:    0x0    0x0
0x55555555a080:    0x0    0x0
0x55555555a090:    0x0    0x0
0x55555555a0a0:    0x0    0x0
0x55555555a0b0:    0x0    0x0
0x55555555a0c0:    0x0    0x0
0x55555555a0d0:    0x0    0x0
0x55555555a0e0:    0x0    0x0
0x55555555a0f0:    0x0    0x0
0x55555555a100:    0x0    0x0
0x55555555a110:    0x0    0x0
0x55555555a120:    0x0    0x0
0x55555555a130:    0x0    0x0
0x55555555a140:    0x0    0x0
0x55555555a150:    0x0    0x0
0x55555555a160:    0x0    0x0
0x55555555a170:    0x0    0x0
0x55555555a180:    0x0    0x0
0x55555555a190:    0x0    0x0
0x55555555a1a0:    0x0    0x0
0x55555555a1b0:    0x0    0x0
0x55555555a1c0:    0x0    0x0
0x55555555a1d0:    0x0    0x0
0x55555555a1e0:    0x0    0x0
0x55555555a1f0:    0x0    0x0
0x55555555a200:    0x0    0x0
0x55555555a210:    0x0    0x0
0x55555555a220:    0x0    0x0
0x55555555a230:    0x0    0x0
0x55555555a240:    0x0    0x0
0x55555555a250:    0x0    0x0
0x55555555a260:    0x0    0x0
0x55555555a270:    0x0    0x0
0x55555555a280:    0x0    0x0
0x55555555a290:    0x0    0x0
0x55555555a2a0:    0x0    0x0
0x55555555a2b0:    0x0    0x0
0x55555555a2c0:    0x0    0x0
0x55555555a2d0:    0x0    0x0
0x55555555a2e0:    0x0    0x0
0x55555555a2f0:    0x0    0x0
0x55555555a300:    0x0    0x0
0x55555555a310:    0x0    0x0
```

So we start off, with seeing our three chunks `0x5555555596a0/0x555555559ad0/0x555555559f00`, with the first chunk `0x5555555596a0` being freed. Let's go ahead and expand the `0x5555555596a0` chunk, to encompass the second chunk `0x555555559ad0`, and prepare for consolidation:

```
gef➤  c
Continuing.
Now to expand the size of chunk0, and set heap chunk data for chunk2.

Now to free chunk2, and cause chunk consolidation to swallow chunk1.


Breakpoint 3, 0x00005555555553e3 in main ()

[ Legend: Modified register | Code | Heap | Stack | String ]
────────────────────────────────────────────────────────────────────────────────────── registers ────
$rax   : 0x0000555555559f10  →  0x0000000000000000
$rbx   : 0x0          	 
$rcx   : 0x00007ffff7cf53b4  →  0x5477fffff0003d48 ("H="?)
$rdx   : 0x0          	 
$rsp   : 0x00007fffffffdf60  →  0x00005555555596b0  →  0x00007ffff7e2cd00  →  0x000055555555a760  →  0x0000000000000000
$rbp   : 0x00007fffffffdf90  →  0x0000000000000001
$rsi   : 0x00005555555592a0  →  "\now to free chunk2, and cause chunk consolidation[...]"
$rdi   : 0x0000555555559f10  →  0x0000000000000000
$rip   : 0x00005555555553e3  →  <main+570> call 0x555555555080 <free@plt>
$r8	: 0x0          	 
$r9	: 0x0          	 
$r10   : 0x00007fffffffdd0c  →  0x0000000000007fff
$r11   : 0x202        	 
$r12   : 0x00007fffffffe0a8  →  0x00007fffffffe3ab  →  "/Hackery/shogun/pwn_demos/malloc/overlapp[...]"
$r13   : 0x00005555555551a9  →  <main+0> endbr64
$r14   : 0x0000555555557d98  →  0x0000555555555160  →  <__do_global_dtors_aux+0> endbr64
$r15   : 0x00007ffff7ffd020  →  0x00007ffff7ffe2e0  →  0x0000555555554000  →   jg 0x555555554047
$eflags: [zero carry PARITY adjust sign trap INTERRUPT direction overflow resume virtualx86 identification]
$cs: 0x33 $ss: 0x2b $ds: 0x00 $es: 0x00 $fs: 0x00 $gs: 0x00
────────────────────────────────────────────────────────────────────────────────────────── stack ────
0x00007fffffffdf60│+0x0000: 0x00005555555596b0  →  0x00007ffff7e2cd00  →  0x000055555555a760  →  0x0000000000000000     ← $rsp
0x00007fffffffdf68│+0x0008: 0x0000555555559ae0  →  0x0000000000000000
0x00007fffffffdf70│+0x0010: 0x0000555555559f10  →  0x0000000000000000
0x00007fffffffdf78│+0x0018: 0x000055555555a340  →  0x0000000000000000
0x00007fffffffdf80│+0x0020: 0x0000000000000000
0x00007fffffffdf88│+0x0028: 0x00007ffff7fe5080  →  <dl_main+0> endbr64
0x00007fffffffdf90│+0x0030: 0x0000000000000001     ← $rbp
0x00007fffffffdf98│+0x0038: 0x00007ffff7c23fbd  →  <__libc_start_call_main+109> mov edi, eax
──────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────
   0x5555555553d7 <main+558>   	call   0x555555555090 <puts@plt>
   0x5555555553dc <main+563>   	mov	rax, QWORD PTR [rbp-0x20]
   0x5555555553e0 <main+567>   	mov	rdi, rax
 → 0x5555555553e3 <main+570>   	call   0x555555555080 <free@plt>
   ↳  0x555555555080 <free@plt+0> 	endbr64
  	0x555555555084 <free@plt+4> 	bnd	jmp QWORD PTR [rip+0x2f2d]    	# 0x555555557fb8 <free@got.plt>
  	0x55555555508b <free@plt+11>	nop	DWORD PTR [rax+rax*1+0x0]
  	0x555555555090 <puts@plt+0> 	endbr64
  	0x555555555094 <puts@plt+4> 	bnd	jmp QWORD PTR [rip+0x2f25]    	# 0x555555557fc0 <puts@got.plt>
  	0x55555555509b <puts@plt+11>	nop	DWORD PTR [rax+rax*1+0x0]
──────────────────────────────────────────────────────────────────────────── arguments (guessed) ────
free@plt (
   $rdi = 0x0000555555559f10 → 0x0000000000000000,
   $rsi = 0x00005555555592a0 → "\now to free chunk2, and cause chunk consolidation[...]"
)
──────────────────────────────────────────────────────────────────────────────────────── threads ────
[#0] Id 1, Name: "overlapping_con", stopped 0x5555555553e3 in main (), reason: BREAKPOINT
────────────────────────────────────────────────────────────────────────────────────────── trace ────
[#0] 0x5555555553e3 → main()
─────────────────────────────────────────────────────────────────────────────────────────────────────
gef➤  x/400g 0x5555555596a0
0x5555555596a0:    0x0    0x860
0x5555555596b0:    0x7ffff7e2cd00    0x7ffff7e2cd00
0x5555555596c0:    0x0    0x0
0x5555555596d0:    0x0    0x0
0x5555555596e0:    0x0    0x0
0x5555555596f0:    0x0    0x0
0x555555559700:    0x0    0x0
0x555555559710:    0x0    0x0
0x555555559720:    0x0    0x0
0x555555559730:    0x0    0x0
0x555555559740:    0x0    0x0
0x555555559750:    0x0    0x0
0x555555559760:    0x0    0x0
0x555555559770:    0x0    0x0
0x555555559780:    0x0    0x0
0x555555559790:    0x0    0x0
0x5555555597a0:    0x0    0x0
0x5555555597b0:    0x0    0x0
0x5555555597c0:    0x0    0x0
0x5555555597d0:    0x0    0x0
0x5555555597e0:    0x0    0x0
0x5555555597f0:    0x0    0x0
0x555555559800:    0x0    0x0
0x555555559810:    0x0    0x0
0x555555559820:    0x0    0x0
0x555555559830:    0x0    0x0
0x555555559840:    0x0    0x0
0x555555559850:    0x0    0x0
0x555555559860:    0x0    0x0
0x555555559870:    0x0    0x0
0x555555559880:    0x0    0x0
0x555555559890:    0x0    0x0
0x5555555598a0:    0x0    0x0
0x5555555598b0:    0x0    0x0
0x5555555598c0:    0x0    0x0
0x5555555598d0:    0x0    0x0
0x5555555598e0:    0x0    0x0
0x5555555598f0:    0x0    0x0
0x555555559900:    0x0    0x0
0x555555559910:    0x0    0x0
0x555555559920:    0x0    0x0
0x555555559930:    0x0    0x0
0x555555559940:    0x0    0x0
0x555555559950:    0x0    0x0
0x555555559960:    0x0    0x0
0x555555559970:    0x0    0x0
0x555555559980:    0x0    0x0
0x555555559990:    0x0    0x0
0x5555555599a0:    0x0    0x0
0x5555555599b0:    0x0    0x0
0x5555555599c0:    0x0    0x0
0x5555555599d0:    0x0    0x0
0x5555555599e0:    0x0    0x0
0x5555555599f0:    0x0    0x0
0x555555559a00:    0x0    0x0
0x555555559a10:    0x0    0x0
0x555555559a20:    0x0    0x0
0x555555559a30:    0x0    0x0
0x555555559a40:    0x0    0x0
0x555555559a50:    0x0    0x0
0x555555559a60:    0x0    0x0
0x555555559a70:    0x0    0x0
0x555555559a80:    0x0    0x0
0x555555559a90:    0x0    0x0
0x555555559aa0:    0x0    0x0
0x555555559ab0:    0x0    0x0
0x555555559ac0:    0x0    0x0
0x555555559ad0:    0x430    0x430
0x555555559ae0:    0x0    0x0
0x555555559af0:    0x0    0x0
0x555555559b00:    0x0    0x0
0x555555559b10:    0x0    0x0
0x555555559b20:    0x0    0x0
0x555555559b30:    0x0    0x0
0x555555559b40:    0x0    0x0
0x555555559b50:    0x0    0x0
0x555555559b60:    0x0    0x0
0x555555559b70:    0x0    0x0
0x555555559b80:    0x0    0x0
0x555555559b90:    0x0    0x0
0x555555559ba0:    0x0    0x0
0x555555559bb0:    0x0    0x0
0x555555559bc0:    0x0    0x0
0x555555559bd0:    0x0    0x0
0x555555559be0:    0x0    0x0
0x555555559bf0:    0x0    0x0
0x555555559c00:    0x0    0x0
0x555555559c10:    0x0    0x0
0x555555559c20:    0x0    0x0
0x555555559c30:    0x0    0x0
0x555555559c40:    0x0    0x0
0x555555559c50:    0x0    0x0
0x555555559c60:    0x0    0x0
0x555555559c70:    0x0    0x0
0x555555559c80:    0x0    0x0
0x555555559c90:    0x0    0x0
0x555555559ca0:    0x0    0x0
0x555555559cb0:    0x0    0x0
0x555555559cc0:    0x0    0x0
0x555555559cd0:    0x0    0x0
0x555555559ce0:    0x0    0x0
0x555555559cf0:    0x0    0x0
0x555555559d00:    0x0    0x0
0x555555559d10:    0x0    0x0
0x555555559d20:    0x0    0x0
0x555555559d30:    0x0    0x0
0x555555559d40:    0x0    0x0
0x555555559d50:    0x0    0x0
0x555555559d60:    0x0    0x0
0x555555559d70:    0x0    0x0
0x555555559d80:    0x0    0x0
0x555555559d90:    0x0    0x0
0x555555559da0:    0x0    0x0
0x555555559db0:    0x0    0x0
0x555555559dc0:    0x0    0x0
0x555555559dd0:    0x0    0x0
0x555555559de0:    0x0    0x0
0x555555559df0:    0x0    0x0
0x555555559e00:    0x0    0x0
0x555555559e10:    0x0    0x0
0x555555559e20:    0x0    0x0
0x555555559e30:    0x0    0x0
0x555555559e40:    0x0    0x0
0x555555559e50:    0x0    0x0
0x555555559e60:    0x0    0x0
0x555555559e70:    0x0    0x0
0x555555559e80:    0x0    0x0
0x555555559e90:    0x0    0x0
0x555555559ea0:    0x0    0x0
0x555555559eb0:    0x0    0x0
0x555555559ec0:    0x0    0x0
0x555555559ed0:    0x0    0x0
0x555555559ee0:    0x0    0x0
0x555555559ef0:    0x0    0x0
0x555555559f00:    0x860    0x430
0x555555559f10:    0x0    0x0
0x555555559f20:    0x0    0x0
0x555555559f30:    0x0    0x0
0x555555559f40:    0x0    0x0
0x555555559f50:    0x0    0x0
0x555555559f60:    0x0    0x0
0x555555559f70:    0x0    0x0
0x555555559f80:    0x0    0x0
0x555555559f90:    0x0    0x0
0x555555559fa0:    0x0    0x0
0x555555559fb0:    0x0    0x0
0x555555559fc0:    0x0    0x0
0x555555559fd0:    0x0    0x0
0x555555559fe0:    0x0    0x0
0x555555559ff0:    0x0    0x0
0x55555555a000:    0x0    0x0
0x55555555a010:    0x0    0x0
0x55555555a020:    0x0    0x0
0x55555555a030:    0x0    0x0
0x55555555a040:    0x0    0x0
0x55555555a050:    0x0    0x0
0x55555555a060:    0x0    0x0
0x55555555a070:    0x0    0x0
0x55555555a080:    0x0    0x0
0x55555555a090:    0x0    0x0
0x55555555a0a0:    0x0    0x0
0x55555555a0b0:    0x0    0x0
0x55555555a0c0:    0x0    0x0
0x55555555a0d0:    0x0    0x0
0x55555555a0e0:    0x0    0x0
0x55555555a0f0:    0x0    0x0
0x55555555a100:    0x0    0x0
0x55555555a110:    0x0    0x0
0x55555555a120:    0x0    0x0
0x55555555a130:    0x0    0x0
0x55555555a140:    0x0    0x0
0x55555555a150:    0x0    0x0
0x55555555a160:    0x0    0x0
0x55555555a170:    0x0    0x0
0x55555555a180:    0x0    0x0
0x55555555a190:    0x0    0x0
0x55555555a1a0:    0x0    0x0
0x55555555a1b0:    0x0    0x0
0x55555555a1c0:    0x0    0x0
0x55555555a1d0:    0x0    0x0
0x55555555a1e0:    0x0    0x0
0x55555555a1f0:    0x0    0x0
0x55555555a200:    0x0    0x0
0x55555555a210:    0x0    0x0
0x55555555a220:    0x0    0x0
0x55555555a230:    0x0    0x0
0x55555555a240:    0x0    0x0
0x55555555a250:    0x0    0x0
0x55555555a260:    0x0    0x0
0x55555555a270:    0x0    0x0
0x55555555a280:    0x0    0x0
0x55555555a290:    0x0    0x0
0x55555555a2a0:    0x0    0x0
0x55555555a2b0:    0x0    0x0
0x55555555a2c0:    0x0    0x0
0x55555555a2d0:    0x0    0x0
0x55555555a2e0:    0x0    0x0
0x55555555a2f0:    0x0    0x0
0x55555555a300:    0x0    0x0
0x55555555a310:    0x0    0x0
gef➤  heap bins
────────────────────────────────────── Tcachebins for thread 1 ──────────────────────────────────────
All tcachebins are empty
─────────────────────────────── Fastbins for arena at 0x7ffff7e2cca0 ───────────────────────────────
Fastbins[idx=0, size=0x20] 0x00
Fastbins[idx=1, size=0x30] 0x00
Fastbins[idx=2, size=0x40] 0x00
Fastbins[idx=3, size=0x50] 0x00
Fastbins[idx=4, size=0x60] 0x00
Fastbins[idx=5, size=0x70] 0x00
Fastbins[idx=6, size=0x80] 0x00
───────────────────────────── Unsorted Bin for arena at 0x7ffff7e2cca0 ─────────────────────────────
[+] unsorted_bins[0]: fw=0x5555555596a0, bk=0x5555555596a0
 →   Chunk(addr=0x5555555596b0, size=0x860, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[+] Found 1 chunks in unsorted bin.
────────────────────────────── Small Bins for arena at 0x7ffff7e2cca0 ──────────────────────────────
[+] Found 0 chunks in 0 small non-empty bins.
────────────────────────────── Large Bins for arena at 0x7ffff7e2cca0 ──────────────────────────────
[+] Found 0 chunks in 0 large non-empty bins.
```

We see, we have edited the third chunk header at `0x555555559f00`, and expanded the size of the first chunk at `0x5555555596a8`. Let's free the third chunk, to cause consolidation:

```
gef➤  c
Continuing.

Breakpoint 4, 0x00005555555553e8 in main ()

[ Legend: Modified register | Code | Heap | Stack | String ]
────────────────────────────────────────────────────────────────────────────────────── registers ────
$rax   : 0x1          	 
$rbx   : 0x0          	 
$rcx   : 0x860        	 
$rdx   : 0x00007ffff7e2cd00  →  0x000055555555a760  →  0x0000000000000000
$rsp   : 0x00007fffffffdf60  →  0x00005555555596b0  →  0x00007ffff7e2cd00  →  0x000055555555a760  →  0x0000000000000000
$rbp   : 0x00007fffffffdf90  →  0x0000000000000001
$rsi   : 0x0          	 
$rdi   : 0x00005555555596a0  →  0x0000000000000000
$rip   : 0x00005555555553e8  →  <main+575> mov edi, 0x420
$r8	: 0x0          	 
$r9	: 0x0          	 
$r10   : 0x00007fffffffdd0c  →  0x0000000000007fff
$r11   : 0x202        	 
$r12   : 0x00007fffffffe0a8  →  0x00007fffffffe3ab  →  "/Hackery/shogun/pwn_demos/malloc/overlapp[...]"
$r13   : 0x00005555555551a9  →  <main+0> endbr64
$r14   : 0x0000555555557d98  →  0x0000555555555160  →  <__do_global_dtors_aux+0> endbr64
$r15   : 0x00007ffff7ffd020  →  0x00007ffff7ffe2e0  →  0x0000555555554000  →   jg 0x555555554047
$eflags: [zero carry PARITY adjust sign trap INTERRUPT direction overflow resume virtualx86 identification]
$cs: 0x33 $ss: 0x2b $ds: 0x00 $es: 0x00 $fs: 0x00 $gs: 0x00
────────────────────────────────────────────────────────────────────────────────────────── stack ────
0x00007fffffffdf60│+0x0000: 0x00005555555596b0  →  0x00007ffff7e2cd00  →  0x000055555555a760  →  0x0000000000000000     ← $rsp
0x00007fffffffdf68│+0x0008: 0x0000555555559ae0  →  0x0000000000000000
0x00007fffffffdf70│+0x0010: 0x0000555555559f10  →  0x0000000000000000
0x00007fffffffdf78│+0x0018: 0x000055555555a340  →  0x0000000000000000
0x00007fffffffdf80│+0x0020: 0x0000000000000000
0x00007fffffffdf88│+0x0028: 0x00007ffff7fe5080  →  <dl_main+0> endbr64
0x00007fffffffdf90│+0x0030: 0x0000000000000001     ← $rbp
0x00007fffffffdf98│+0x0038: 0x00007ffff7c23fbd  →  <__libc_start_call_main+109> mov edi, eax
──────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────
   0x5555555553dc <main+563>   	mov	rax, QWORD PTR [rbp-0x20]
   0x5555555553e0 <main+567>   	mov	rdi, rax
   0x5555555553e3 <main+570>   	call   0x555555555080 <free@plt>
 → 0x5555555553e8 <main+575>   	mov	edi, 0x420
   0x5555555553ed <main+580>   	call   0x5555555550b0 <malloc@plt>
   0x5555555553f2 <main+585>   	mov	QWORD PTR [rbp-0x10], rax
   0x5555555553f6 <main+589>   	mov	edi, 0x420
   0x5555555553fb <main+594>   	call   0x5555555550b0 <malloc@plt>
   0x555555555400 <main+599>   	mov	QWORD PTR [rbp-0x8], rax
──────────────────────────────────────────────────────────────────────────────────────── threads ────
[#0] Id 1, Name: "overlapping_con", stopped 0x5555555553e8 in main (), reason: BREAKPOINT
────────────────────────────────────────────────────────────────────────────────────────── trace ────
[#0] 0x5555555553e8 → main()
─────────────────────────────────────────────────────────────────────────────────────────────────────
gef➤  heap bins
────────────────────────────────────── Tcachebins for thread 1 ──────────────────────────────────────
All tcachebins are empty
─────────────────────────────── Fastbins for arena at 0x7ffff7e2cca0 ───────────────────────────────
Fastbins[idx=0, size=0x20] 0x00
Fastbins[idx=1, size=0x30] 0x00
Fastbins[idx=2, size=0x40] 0x00
Fastbins[idx=3, size=0x50] 0x00
Fastbins[idx=4, size=0x60] 0x00
Fastbins[idx=5, size=0x70] 0x00
Fastbins[idx=6, size=0x80] 0x00
───────────────────────────── Unsorted Bin for arena at 0x7ffff7e2cca0 ─────────────────────────────
[+] unsorted_bins[0]: fw=0x5555555596a0, bk=0x5555555596a0
 →   Chunk(addr=0x5555555596b0, size=0xc90, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[+] Found 1 chunks in unsorted bin.
────────────────────────────── Small Bins for arena at 0x7ffff7e2cca0 ──────────────────────────────
[+] Found 0 chunks in 0 small non-empty bins.
────────────────────────────── Large Bins for arena at 0x7ffff7e2cca0 ──────────────────────────────
[+] Found 0 chunks in 0 large non-empty bins.
gef➤  x/400g 0x5555555596a0
0x5555555596a0:    0x0    0xc91
0x5555555596b0:    0x7ffff7e2cd00    0x7ffff7e2cd00
0x5555555596c0:    0x0    0x0
0x5555555596d0:    0x0    0x0
0x5555555596e0:    0x0    0x0
0x5555555596f0:    0x0    0x0
0x555555559700:    0x0    0x0
0x555555559710:    0x0    0x0
0x555555559720:    0x0    0x0
0x555555559730:    0x0    0x0
0x555555559740:    0x0    0x0
0x555555559750:    0x0    0x0
0x555555559760:    0x0    0x0
0x555555559770:    0x0    0x0
0x555555559780:    0x0    0x0
0x555555559790:    0x0    0x0
0x5555555597a0:    0x0    0x0
0x5555555597b0:    0x0    0x0
0x5555555597c0:    0x0    0x0
0x5555555597d0:    0x0    0x0
0x5555555597e0:    0x0    0x0
0x5555555597f0:    0x0    0x0
0x555555559800:    0x0    0x0
0x555555559810:    0x0    0x0
0x555555559820:    0x0    0x0
0x555555559830:    0x0    0x0
0x555555559840:    0x0    0x0
0x555555559850:    0x0    0x0
0x555555559860:    0x0    0x0
0x555555559870:    0x0    0x0
0x555555559880:    0x0    0x0
0x555555559890:    0x0    0x0
0x5555555598a0:    0x0    0x0
0x5555555598b0:    0x0    0x0
0x5555555598c0:    0x0    0x0
0x5555555598d0:    0x0    0x0
0x5555555598e0:    0x0    0x0
0x5555555598f0:    0x0    0x0
0x555555559900:    0x0    0x0
0x555555559910:    0x0    0x0
0x555555559920:    0x0    0x0
0x555555559930:    0x0    0x0
0x555555559940:    0x0    0x0
0x555555559950:    0x0    0x0
0x555555559960:    0x0    0x0
0x555555559970:    0x0    0x0
0x555555559980:    0x0    0x0
0x555555559990:    0x0    0x0
0x5555555599a0:    0x0    0x0
0x5555555599b0:    0x0    0x0
0x5555555599c0:    0x0    0x0
0x5555555599d0:    0x0    0x0
0x5555555599e0:    0x0    0x0
0x5555555599f0:    0x0    0x0
0x555555559a00:    0x0    0x0
0x555555559a10:    0x0    0x0
0x555555559a20:    0x0    0x0
0x555555559a30:    0x0    0x0
0x555555559a40:    0x0    0x0
0x555555559a50:    0x0    0x0
0x555555559a60:    0x0    0x0
0x555555559a70:    0x0    0x0
0x555555559a80:    0x0    0x0
0x555555559a90:    0x0    0x0
0x555555559aa0:    0x0    0x0
0x555555559ab0:    0x0    0x0
0x555555559ac0:    0x0    0x0
0x555555559ad0:    0x430    0x430
0x555555559ae0:    0x0    0x0
0x555555559af0:    0x0    0x0
0x555555559b00:    0x0    0x0
0x555555559b10:    0x0    0x0
0x555555559b20:    0x0    0x0
0x555555559b30:    0x0    0x0
0x555555559b40:    0x0    0x0
0x555555559b50:    0x0    0x0
0x555555559b60:    0x0    0x0
0x555555559b70:    0x0    0x0
0x555555559b80:    0x0    0x0
0x555555559b90:    0x0    0x0
0x555555559ba0:    0x0    0x0
0x555555559bb0:    0x0    0x0
0x555555559bc0:    0x0    0x0
0x555555559bd0:    0x0    0x0
0x555555559be0:    0x0    0x0
0x555555559bf0:    0x0    0x0
0x555555559c00:    0x0    0x0
0x555555559c10:    0x0    0x0
0x555555559c20:    0x0    0x0
0x555555559c30:    0x0    0x0
0x555555559c40:    0x0    0x0
0x555555559c50:    0x0    0x0
0x555555559c60:    0x0    0x0
0x555555559c70:    0x0    0x0
0x555555559c80:    0x0    0x0
0x555555559c90:    0x0    0x0
0x555555559ca0:    0x0    0x0
0x555555559cb0:    0x0    0x0
0x555555559cc0:    0x0    0x0
0x555555559cd0:    0x0    0x0
0x555555559ce0:    0x0    0x0
0x555555559cf0:    0x0    0x0
0x555555559d00:    0x0    0x0
0x555555559d10:    0x0    0x0
0x555555559d20:    0x0    0x0
0x555555559d30:    0x0    0x0
0x555555559d40:    0x0    0x0
0x555555559d50:    0x0    0x0
0x555555559d60:    0x0    0x0
0x555555559d70:    0x0    0x0
0x555555559d80:    0x0    0x0
0x555555559d90:    0x0    0x0
0x555555559da0:    0x0    0x0
0x555555559db0:    0x0    0x0
0x555555559dc0:    0x0    0x0
0x555555559dd0:    0x0    0x0
0x555555559de0:    0x0    0x0
0x555555559df0:    0x0    0x0
0x555555559e00:    0x0    0x0
0x555555559e10:    0x0    0x0
0x555555559e20:    0x0    0x0
0x555555559e30:    0x0    0x0
0x555555559e40:    0x0    0x0
0x555555559e50:    0x0    0x0
0x555555559e60:    0x0    0x0
0x555555559e70:    0x0    0x0
0x555555559e80:    0x0    0x0
0x555555559e90:    0x0    0x0
0x555555559ea0:    0x0    0x0
0x555555559eb0:    0x0    0x0
0x555555559ec0:    0x0    0x0
0x555555559ed0:    0x0    0x0
0x555555559ee0:    0x0    0x0
0x555555559ef0:    0x0    0x0
0x555555559f00:    0x860    0x430
0x555555559f10:    0x0    0x0
0x555555559f20:    0x0    0x0
0x555555559f30:    0x0    0x0
0x555555559f40:    0x0    0x0
0x555555559f50:    0x0    0x0
0x555555559f60:    0x0    0x0
0x555555559f70:    0x0    0x0
0x555555559f80:    0x0    0x0
0x555555559f90:    0x0    0x0
0x555555559fa0:    0x0    0x0
0x555555559fb0:    0x0    0x0
0x555555559fc0:    0x0    0x0
0x555555559fd0:    0x0    0x0
0x555555559fe0:    0x0    0x0
0x555555559ff0:    0x0    0x0
0x55555555a000:    0x0    0x0
0x55555555a010:    0x0    0x0
0x55555555a020:    0x0    0x0
0x55555555a030:    0x0    0x0
0x55555555a040:    0x0    0x0
0x55555555a050:    0x0    0x0
0x55555555a060:    0x0    0x0
0x55555555a070:    0x0    0x0
0x55555555a080:    0x0    0x0
0x55555555a090:    0x0    0x0
0x55555555a0a0:    0x0    0x0
0x55555555a0b0:    0x0    0x0
0x55555555a0c0:    0x0    0x0
0x55555555a0d0:    0x0    0x0
0x55555555a0e0:    0x0    0x0
0x55555555a0f0:    0x0    0x0
0x55555555a100:    0x0    0x0
0x55555555a110:    0x0    0x0
0x55555555a120:    0x0    0x0
0x55555555a130:    0x0    0x0
0x55555555a140:    0x0    0x0
0x55555555a150:    0x0    0x0
0x55555555a160:    0x0    0x0
0x55555555a170:    0x0    0x0
0x55555555a180:    0x0    0x0
0x55555555a190:    0x0    0x0
0x55555555a1a0:    0x0    0x0
0x55555555a1b0:    0x0    0x0
0x55555555a1c0:    0x0    0x0
0x55555555a1d0:    0x0    0x0
0x55555555a1e0:    0x0    0x0
0x55555555a1f0:    0x0    0x0
0x55555555a200:    0x0    0x0
0x55555555a210:    0x0    0x0
0x55555555a220:    0x0    0x0
0x55555555a230:    0x0    0x0
0x55555555a240:    0x0    0x0
0x55555555a250:    0x0    0x0
0x55555555a260:    0x0    0x0
0x55555555a270:    0x0    0x0
0x55555555a280:    0x0    0x0
0x55555555a290:    0x0    0x0
0x55555555a2a0:    0x0    0x0
0x55555555a2b0:    0x0    0x0
0x55555555a2c0:    0x0    0x0
0x55555555a2d0:    0x0    0x0
0x55555555a2e0:    0x0    0x0
0x55555555a2f0:    0x0    0x0
0x55555555a300:    0x0    0x0
0x55555555a310:    0x0    0x0
```

So we see, we now have one large consolidated chunk where the first chunk began. Let's go ahead, and allocate a chunk off of that consolidated chunk, to move the start of it to overlap directly with the second chunk at `0x555555559ad0`:

```
gef➤  c
Continuing.

Breakpoint 5, 0x00005555555553f2 in main ()

[ Legend: Modified register | Code | Heap | Stack | String ]
────────────────────────────────────────────────────────────────────────────────────── registers ────
$rax   : 0x00005555555596b0  →  0x00007ffff7e2d300  →  0x00007ffff7e2d2f0  →  0x00007ffff7e2d2e0  →  0x00007ffff7e2d2d0  →  0x00007ffff7e2d2c0  →  0x00007ffff7e2d2b0  →  0x00007ffff7e2d2a0
$rbx   : 0x0          	 
$rcx   : 0x00005555555596a0  →  0x0000000000000000
$rdx   : 0x0          	 
$rsp   : 0x00007fffffffdf60  →  0x00005555555596b0  →  0x00007ffff7e2d300  →  0x00007ffff7e2d2f0  →  0x00007ffff7e2d2e0  →  0x00007ffff7e2d2d0  →  0x00007ffff7e2d2c0  →  0x00007ffff7e2d2b0
$rbp   : 0x00007fffffffdf90  →  0x0000000000000001
$rsi   : 0x2          	 
$rdi   : 0x00005555555596a0  →  0x0000000000000000
$rip   : 0x00005555555553f2  →  <main+585> mov QWORD PTR [rbp-0x10], rax
$r8	: 0x3          	 
$r9	: 0x0          	 
$r10   : 0x2          	 
$r11   : 0x00007ffff7e2cca0  →  0x0000000000000000
$r12   : 0x00007fffffffe0a8  →  0x00007fffffffe3ab  →  "/Hackery/shogun/pwn_demos/malloc/overlapp[...]"
$r13   : 0x00005555555551a9  →  <main+0> endbr64
$r14   : 0x0000555555557d98  →  0x0000555555555160  →  <__do_global_dtors_aux+0> endbr64
$r15   : 0x00007ffff7ffd020  →  0x00007ffff7ffe2e0  →  0x0000555555554000  →   jg 0x555555554047
$eflags: [zero carry parity adjust sign trap INTERRUPT direction overflow resume virtualx86 identification]
$cs: 0x33 $ss: 0x2b $ds: 0x00 $es: 0x00 $fs: 0x00 $gs: 0x00
────────────────────────────────────────────────────────────────────────────────────────── stack ────
0x00007fffffffdf60│+0x0000: 0x00005555555596b0  →  0x00007ffff7e2d300  →  0x00007ffff7e2d2f0  →  0x00007ffff7e2d2e0  →  0x00007ffff7e2d2d0  →  0x00007ffff7e2d2c0  →  0x00007ffff7e2d2b0     ← $rsp
0x00007fffffffdf68│+0x0008: 0x0000555555559ae0  →  0x00007ffff7e2cd00  →  0x000055555555a760  →  0x0000000000000000
0x00007fffffffdf70│+0x0010: 0x0000555555559f10  →  0x0000000000000000
0x00007fffffffdf78│+0x0018: 0x000055555555a340  →  0x0000000000000000
0x00007fffffffdf80│+0x0020: 0x0000000000000000
0x00007fffffffdf88│+0x0028: 0x00007ffff7fe5080  →  <dl_main+0> endbr64
0x00007fffffffdf90│+0x0030: 0x0000000000000001     ← $rbp
0x00007fffffffdf98│+0x0038: 0x00007ffff7c23fbd  →  <__libc_start_call_main+109> mov edi, eax
──────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────
   0x5555555553e3 <main+570>   	call   0x555555555080 <free@plt>
   0x5555555553e8 <main+575>   	mov	edi, 0x420
   0x5555555553ed <main+580>   	call   0x5555555550b0 <malloc@plt>
 → 0x5555555553f2 <main+585>   	mov	QWORD PTR [rbp-0x10], rax
   0x5555555553f6 <main+589>   	mov	edi, 0x420
   0x5555555553fb <main+594>   	call   0x5555555550b0 <malloc@plt>
   0x555555555400 <main+599>   	mov	QWORD PTR [rbp-0x8], rax
   0x555555555404 <main+603>   	mov	rax, QWORD PTR [rbp-0x10]
   0x555555555408 <main+607>   	mov	rsi, rax
──────────────────────────────────────────────────────────────────────────────────────── threads ────
[#0] Id 1, Name: "overlapping_con", stopped 0x5555555553f2 in main (), reason: BREAKPOINT
────────────────────────────────────────────────────────────────────────────────────────── trace ────
[#0] 0x5555555553f2 → main()
─────────────────────────────────────────────────────────────────────────────────────────────────────
gef➤  p $rax
$2 = 0x5555555596b0
gef➤  heap bins
────────────────────────────────────── Tcachebins for thread 1 ──────────────────────────────────────
All tcachebins are empty
─────────────────────────────── Fastbins for arena at 0x7ffff7e2cca0 ───────────────────────────────
Fastbins[idx=0, size=0x20] 0x00
Fastbins[idx=1, size=0x30] 0x00
Fastbins[idx=2, size=0x40] 0x00
Fastbins[idx=3, size=0x50] 0x00
Fastbins[idx=4, size=0x60] 0x00
Fastbins[idx=5, size=0x70] 0x00
Fastbins[idx=6, size=0x80] 0x00
───────────────────────────── Unsorted Bin for arena at 0x7ffff7e2cca0 ─────────────────────────────
[+] unsorted_bins[0]: fw=0x555555559ad0, bk=0x555555559ad0
 →   Chunk(addr=0x555555559ae0, size=0x860, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[+] Found 1 chunks in unsorted bin.
────────────────────────────── Small Bins for arena at 0x7ffff7e2cca0 ──────────────────────────────
[+] Found 0 chunks in 0 small non-empty bins.
────────────────────────────── Large Bins for arena at 0x7ffff7e2cca0 ──────────────────────────────
[+] Found 0 chunks in 0 large non-empty bins.
gef➤  x/400g 0x5555555596a0
0x5555555596a0:    0x0    0x431
0x5555555596b0:    0x7ffff7e2d300    0x7ffff7e2d300
0x5555555596c0:    0x5555555596a0    0x5555555596a0
0x5555555596d0:    0x0    0x0
0x5555555596e0:    0x0    0x0
0x5555555596f0:    0x0    0x0
0x555555559700:    0x0    0x0
0x555555559710:    0x0    0x0
0x555555559720:    0x0    0x0
0x555555559730:    0x0    0x0
0x555555559740:    0x0    0x0
0x555555559750:    0x0    0x0
0x555555559760:    0x0    0x0
0x555555559770:    0x0    0x0
0x555555559780:    0x0    0x0
0x555555559790:    0x0    0x0
0x5555555597a0:    0x0    0x0
0x5555555597b0:    0x0    0x0
0x5555555597c0:    0x0    0x0
0x5555555597d0:    0x0    0x0
0x5555555597e0:    0x0    0x0
0x5555555597f0:    0x0    0x0
0x555555559800:    0x0    0x0
0x555555559810:    0x0    0x0
0x555555559820:    0x0    0x0
0x555555559830:    0x0    0x0
0x555555559840:    0x0    0x0
0x555555559850:    0x0    0x0
0x555555559860:    0x0    0x0
0x555555559870:    0x0    0x0
0x555555559880:    0x0    0x0
0x555555559890:    0x0    0x0
0x5555555598a0:    0x0    0x0
0x5555555598b0:    0x0    0x0
0x5555555598c0:    0x0    0x0
0x5555555598d0:    0x0    0x0
0x5555555598e0:    0x0    0x0
0x5555555598f0:    0x0    0x0
0x555555559900:    0x0    0x0
0x555555559910:    0x0    0x0
0x555555559920:    0x0    0x0
0x555555559930:    0x0    0x0
0x555555559940:    0x0    0x0
0x555555559950:    0x0    0x0
0x555555559960:    0x0    0x0
0x555555559970:    0x0    0x0
0x555555559980:    0x0    0x0
0x555555559990:    0x0    0x0
0x5555555599a0:    0x0    0x0
0x5555555599b0:    0x0    0x0
0x5555555599c0:    0x0    0x0
0x5555555599d0:    0x0    0x0
0x5555555599e0:    0x0    0x0
0x5555555599f0:    0x0    0x0
0x555555559a00:    0x0    0x0
0x555555559a10:    0x0    0x0
0x555555559a20:    0x0    0x0
0x555555559a30:    0x0    0x0
0x555555559a40:    0x0    0x0
0x555555559a50:    0x0    0x0
0x555555559a60:    0x0    0x0
0x555555559a70:    0x0    0x0
0x555555559a80:    0x0    0x0
0x555555559a90:    0x0    0x0
0x555555559aa0:    0x0    0x0
0x555555559ab0:    0x0    0x0
0x555555559ac0:    0x0    0x0
0x555555559ad0:    0x430    0x861
0x555555559ae0:    0x7ffff7e2cd00    0x7ffff7e2cd00
0x555555559af0:    0x0    0x0
0x555555559b00:    0x0    0x0
0x555555559b10:    0x0    0x0
0x555555559b20:    0x0    0x0
0x555555559b30:    0x0    0x0
0x555555559b40:    0x0    0x0
0x555555559b50:    0x0    0x0
0x555555559b60:    0x0    0x0
0x555555559b70:    0x0    0x0
0x555555559b80:    0x0    0x0
0x555555559b90:    0x0    0x0
0x555555559ba0:    0x0    0x0
0x555555559bb0:    0x0    0x0
0x555555559bc0:    0x0    0x0
0x555555559bd0:    0x0    0x0
0x555555559be0:    0x0    0x0
0x555555559bf0:    0x0    0x0
0x555555559c00:    0x0    0x0
0x555555559c10:    0x0    0x0
0x555555559c20:    0x0    0x0
0x555555559c30:    0x0    0x0
0x555555559c40:    0x0    0x0
0x555555559c50:    0x0    0x0
0x555555559c60:    0x0    0x0
0x555555559c70:    0x0    0x0
0x555555559c80:    0x0    0x0
0x555555559c90:    0x0    0x0
0x555555559ca0:    0x0    0x0
0x555555559cb0:    0x0    0x0
0x555555559cc0:    0x0    0x0
0x555555559cd0:    0x0    0x0
0x555555559ce0:    0x0    0x0
0x555555559cf0:    0x0    0x0
0x555555559d00:    0x0    0x0
0x555555559d10:    0x0    0x0
0x555555559d20:    0x0    0x0
0x555555559d30:    0x0    0x0
0x555555559d40:    0x0    0x0
0x555555559d50:    0x0    0x0
0x555555559d60:    0x0    0x0
0x555555559d70:    0x0    0x0
0x555555559d80:    0x0    0x0
0x555555559d90:    0x0    0x0
0x555555559da0:    0x0    0x0
0x555555559db0:    0x0    0x0
0x555555559dc0:    0x0    0x0
0x555555559dd0:    0x0    0x0
0x555555559de0:    0x0    0x0
0x555555559df0:    0x0    0x0
0x555555559e00:    0x0    0x0
0x555555559e10:    0x0    0x0
0x555555559e20:    0x0    0x0
0x555555559e30:    0x0    0x0
0x555555559e40:    0x0    0x0
0x555555559e50:    0x0    0x0
0x555555559e60:    0x0    0x0
0x555555559e70:    0x0    0x0
0x555555559e80:    0x0    0x0
0x555555559e90:    0x0    0x0
0x555555559ea0:    0x0    0x0
0x555555559eb0:    0x0    0x0
0x555555559ec0:    0x0    0x0
0x555555559ed0:    0x0    0x0
0x555555559ee0:    0x0    0x0
0x555555559ef0:    0x0    0x0
0x555555559f00:    0x860    0x430
0x555555559f10:    0x0    0x0
0x555555559f20:    0x0    0x0
0x555555559f30:    0x0    0x0
0x555555559f40:    0x0    0x0
0x555555559f50:    0x0    0x0
0x555555559f60:    0x0    0x0
0x555555559f70:    0x0    0x0
0x555555559f80:    0x0    0x0
0x555555559f90:    0x0    0x0
0x555555559fa0:    0x0    0x0
0x555555559fb0:    0x0    0x0
0x555555559fc0:    0x0    0x0
0x555555559fd0:    0x0    0x0
0x555555559fe0:    0x0    0x0
0x555555559ff0:    0x0    0x0
0x55555555a000:    0x0    0x0
0x55555555a010:    0x0    0x0
0x55555555a020:    0x0    0x0
0x55555555a030:    0x0    0x0
0x55555555a040:    0x0    0x0
0x55555555a050:    0x0    0x0
0x55555555a060:    0x0    0x0
0x55555555a070:    0x0    0x0
0x55555555a080:    0x0    0x0
0x55555555a090:    0x0    0x0
0x55555555a0a0:    0x0    0x0
0x55555555a0b0:    0x0    0x0
0x55555555a0c0:    0x0    0x0
0x55555555a0d0:    0x0    0x0
0x55555555a0e0:    0x0    0x0
0x55555555a0f0:    0x0    0x0
0x55555555a100:    0x0    0x0
0x55555555a110:    0x0    0x0
0x55555555a120:    0x0    0x0
0x55555555a130:    0x0    0x0
0x55555555a140:    0x0    0x0
0x55555555a150:    0x0    0x0
0x55555555a160:    0x0    0x0
0x55555555a170:    0x0    0x0
0x55555555a180:    0x0    0x0
0x55555555a190:    0x0    0x0
0x55555555a1a0:    0x0    0x0
0x55555555a1b0:    0x0    0x0
0x55555555a1c0:    0x0    0x0
0x55555555a1d0:    0x0    0x0
0x55555555a1e0:    0x0    0x0
0x55555555a1f0:    0x0    0x0
0x55555555a200:    0x0    0x0
0x55555555a210:    0x0    0x0
0x55555555a220:    0x0    0x0
0x55555555a230:    0x0    0x0
0x55555555a240:    0x0    0x0
0x55555555a250:    0x0    0x0
0x55555555a260:    0x0    0x0
0x55555555a270:    0x0    0x0
0x55555555a280:    0x0    0x0
0x55555555a290:    0x0    0x0
0x55555555a2a0:    0x0    0x0
0x55555555a2b0:    0x0    0x0
0x55555555a2c0:    0x0    0x0
0x55555555a2d0:    0x0    0x0
0x55555555a2e0:    0x0    0x0
0x55555555a2f0:    0x0    0x0
0x55555555a300:    0x0    0x0
0x55555555a310:    0x0    0x0
```

So we see here, we have an unsorted bin chunk which overlaps directly with the second chunk. Let's allocate a chunk form it, and we will get overlapping chunks:

```
gef➤  c
Continuing.

Breakpoint 6, 0x0000555555555400 in main ()

[ Legend: Modified register | Code | Heap | Stack | String ]
────────────────────────────────────────────────────────────────────────────────────── registers ────
$rax   : 0x0000555555559ae0  →  0x00007ffff7e2d200  →  0x00007ffff7e2d1f0  →  0x00007ffff7e2d1e0  →  0x00007ffff7e2d1d0  →  0x00007ffff7e2d1c0  →  0x00007ffff7e2d1b0  →  0x00007ffff7e2d1a0
$rbx   : 0x0          	 
$rcx   : 0x0000555555559ad0  →  0x0000000000000430
$rdx   : 0x0          	 
$rsp   : 0x00007fffffffdf60  →  0x00005555555596b0  →  0x00007ffff7e2d300  →  0x00007ffff7e2d2f0  →  0x00007ffff7e2d2e0  →  0x00007ffff7e2d2d0  →  0x00007ffff7e2d2c0  →  0x00007ffff7e2d2b0
$rbp   : 0x00007fffffffdf90  →  0x0000000000000001
$rsi   : 0x20000      	 
$rdi   : 0x0000555555559ad0  →  0x0000000000000430
$rip   : 0x0000555555555400  →  <main+599> mov QWORD PTR [rbp-0x8], rax
$r8	: 0x2          	 
$r9	: 0x0          	 
$r10   : 0x20000      	 
$r11   : 0x00007ffff7e2cca0  →  0x0000000000000000
$r12   : 0x00007fffffffe0a8  →  0x00007fffffffe3ab  →  "/Hackery/shogun/pwn_demos/malloc/overlapp[...]"
$r13   : 0x00005555555551a9  →  <main+0> endbr64
$r14   : 0x0000555555557d98  →  0x0000555555555160  →  <__do_global_dtors_aux+0> endbr64
$r15   : 0x00007ffff7ffd020  →  0x00007ffff7ffe2e0  →  0x0000555555554000  →   jg 0x555555554047
$eflags: [zero carry parity adjust sign trap INTERRUPT direction overflow resume virtualx86 identification]
$cs: 0x33 $ss: 0x2b $ds: 0x00 $es: 0x00 $fs: 0x00 $gs: 0x00
────────────────────────────────────────────────────────────────────────────────────────── stack ────
0x00007fffffffdf60│+0x0000: 0x00005555555596b0  →  0x00007ffff7e2d300  →  0x00007ffff7e2d2f0  →  0x00007ffff7e2d2e0  →  0x00007ffff7e2d2d0  →  0x00007ffff7e2d2c0  →  0x00007ffff7e2d2b0     ← $rsp
0x00007fffffffdf68│+0x0008: 0x0000555555559ae0  →  0x00007ffff7e2d200  →  0x00007ffff7e2d1f0  →  0x00007ffff7e2d1e0  →  0x00007ffff7e2d1d0  →  0x00007ffff7e2d1c0  →  0x00007ffff7e2d1b0
0x00007fffffffdf70│+0x0010: 0x0000555555559f10  →  0x00007ffff7e2cd00  →  0x000055555555a760  →  0x0000000000000000
0x00007fffffffdf78│+0x0018: 0x000055555555a340  →  0x0000000000000000
0x00007fffffffdf80│+0x0020: 0x00005555555596b0  →  0x00007ffff7e2d300  →  0x00007ffff7e2d2f0  →  0x00007ffff7e2d2e0  →  0x00007ffff7e2d2d0  →  0x00007ffff7e2d2c0  →  0x00007ffff7e2d2b0
0x00007fffffffdf88│+0x0028: 0x00007ffff7fe5080  →  <dl_main+0> endbr64
0x00007fffffffdf90│+0x0030: 0x0000000000000001     ← $rbp
0x00007fffffffdf98│+0x0038: 0x00007ffff7c23fbd  →  <__libc_start_call_main+109> mov edi, eax
──────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────
   0x5555555553f2 <main+585>   	mov	QWORD PTR [rbp-0x10], rax
   0x5555555553f6 <main+589>   	mov	edi, 0x420
   0x5555555553fb <main+594>   	call   0x5555555550b0 <malloc@plt>
 → 0x555555555400 <main+599>   	mov	QWORD PTR [rbp-0x8], rax
   0x555555555404 <main+603>   	mov	rax, QWORD PTR [rbp-0x10]
   0x555555555408 <main+607>   	mov	rsi, rax
   0x55555555540b <main+610>   	lea	rax, [rip+0x125e]    	# 0x555555556670
   0x555555555412 <main+617>   	mov	rdi, rax
   0x555555555415 <main+620>   	mov	eax, 0x0
──────────────────────────────────────────────────────────────────────────────────────── threads ────
[#0] Id 1, Name: "overlapping_con", stopped 0x555555555400 in main (), reason: BREAKPOINT
────────────────────────────────────────────────────────────────────────────────────────── trace ────
[#0] 0x555555555400 → main()
─────────────────────────────────────────────────────────────────────────────────────────────────────
gef➤  p $rax
$3 = 0x555555559ae0
gef➤  c
Continuing.
First chunk allocated from consolidated chunk: 0x5555555596b0
Overlapping Chunk: 0x555555559ae0
Is the chunk overlapping:    True
[Inferior 1 (process 3931) exited with code 037]
```

Just like that, we were able to allocate the `0x555555559ad0` chunk (with the user data section starting at `0x555555559ae0`) again without freeing it!
